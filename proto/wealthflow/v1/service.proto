syntax = "proto3";

package wealthflow.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/simaogato/wealthflow-backend/proto/wealthflow/v1;wealthflowv1";

// WealthFlowService provides RPCs for managing financial transactions
service WealthFlowService {
  // RecordInflow records an income/inflow transaction
  // If is_external is true, triggers the Split Rule Engine to distribute funds
  rpc RecordInflow(RecordInflowRequest) returns (RecordInflowResponse);

  // LogExpense records an expense transaction with double-layer accounting
  // Creates entries in both Physical and Virtual layers
  rpc LogExpense(LogExpenseRequest) returns (LogExpenseResponse);

  // UpdateInvestment updates the market value for an investment bucket
  // Inserts a new entry into market_value_history (does NOT create a transaction)
  rpc UpdateInvestment(UpdateInvestmentRequest) returns (UpdateInvestmentResponse);

  // ListBuckets returns a list of buckets, optionally filtered by type
  rpc ListBuckets(ListBucketsRequest) returns (ListBucketsResponse);

  // ListTransactions returns a paginated list of transactions
  rpc ListTransactions(ListTransactionsRequest) returns (ListTransactionsResponse);

  // GetNetWorth calculates and returns the total net worth
  rpc GetNetWorth(GetNetWorthRequest) returns (GetNetWorthResponse);
}

// RecordInflowRequest represents an income/inflow transaction
message RecordInflowRequest {
  // Amount as a decimal string (e.g., "1000.50") to preserve precision
  string amount = 1;
  
  // Description of the inflow transaction
  string description = 2;
  
  // Source bucket ID (UUID as string) - typically an Income or Physical bucket
  string source_bucket_id = 3;
  
  // If true, this is an external inflow that triggers Split Rule Engine
  bool is_external = 4;
  
  // Optional: Transaction date (defaults to server time if not provided)
  google.protobuf.Timestamp date = 5;
}

// RecordInflowResponse returns the created transaction details
message RecordInflowResponse {
  // Transaction ID (UUID as string)
  string transaction_id = 1;
  
  // Timestamp when the transaction was created
  google.protobuf.Timestamp created_at = 2;
}

// LogExpenseRequest represents an expense transaction
message LogExpenseRequest {
  // Amount as a decimal string (e.g., "25.99") to preserve precision
  string amount = 1;
  
  // Description of the expense
  string description = 2;
  
  // Virtual bucket ID (UUID as string) - the virtual bucket being debited
  string virtual_bucket_id = 3;
  
  // Category bucket ID (UUID as string) - the external expense category
  string category_bucket_id = 4;
  
  // Optional: Override the physical bucket to credit
  // If not provided, uses the parent physical bucket of virtual_bucket_id
  string physical_bucket_override_id = 5;
  
  // Optional: Transaction date (defaults to server time if not provided)
  google.protobuf.Timestamp date = 6;
}

// LogExpenseResponse returns the created transaction details
message LogExpenseResponse {
  // Transaction ID (UUID as string)
  string transaction_id = 1;
  
  // Timestamp when the transaction was created
  google.protobuf.Timestamp created_at = 2;
  
  // Physical bucket ID that was actually credited (useful when override was used)
  string physical_bucket_id = 3;
}

// UpdateInvestmentRequest represents a market value update for an investment bucket
message UpdateInvestmentRequest {
  // Bucket ID (UUID as string) - must be an EQUITY type bucket
  string bucket_id = 1;
  
  // Market value as a decimal string (e.g., "650.00") to preserve precision
  string market_value = 2;
  
  // Optional: Date of the market value (defaults to server time if not provided)
  google.protobuf.Timestamp date = 3;
}

// UpdateInvestmentResponse confirms the market value update
message UpdateInvestmentResponse {
  // Market value history entry ID (UUID as string)
  string entry_id = 1;
  
  // Timestamp when the entry was created
  google.protobuf.Timestamp created_at = 2;
}

// ListBucketsRequest represents a request to list buckets
message ListBucketsRequest {
  // Optional: Filter by bucket type (e.g., "PHYSICAL", "VIRTUAL", "INCOME", "EXPENSE", "EQUITY", "SYSTEM")
  string bucket_type = 1;
}

// ListBucketsResponse returns a list of buckets
message ListBucketsResponse {
  // List of buckets
  repeated Bucket buckets = 1;
}

// Bucket represents a bucket in the system
message Bucket {
  // Bucket ID (UUID as string)
  string id = 1;
  
  // Bucket name
  string name = 2;
  
  // Bucket type (e.g., "PHYSICAL", "VIRTUAL", "INCOME", "EXPENSE", "EQUITY", "SYSTEM")
  string type = 3;
  
  // Current balance as a decimal string (e.g., "1000.50") to preserve precision
  string current_balance = 4;
  
  // Optional: Parent physical bucket ID (UUID as string) - only set for VIRTUAL buckets
  string parent_id = 5;
}

// ListTransactionsRequest represents a request to list transactions
message ListTransactionsRequest {
  // Maximum number of transactions to return
  int32 limit = 1;
  
  // Number of transactions to skip (for pagination)
  int32 offset = 2;
  
  // Optional: Filter by bucket ID (UUID as string) - returns transactions involving this bucket
  string bucket_id = 3;
}

// ListTransactionsResponse returns a list of transactions
message ListTransactionsResponse {
  // List of transactions
  repeated Transaction transactions = 1;
  
  // Total count of transactions (for pagination)
  int32 total_count = 2;
}

// Transaction represents a transaction in the system
message Transaction {
  // Transaction ID (UUID as string)
  string id = 1;
  
  // Transaction description
  string description = 2;
  
  // Transaction amount as a decimal string (e.g., "100.50") - represents the total transaction amount
  string amount = 3;
  
  // Transaction date
  google.protobuf.Timestamp date = 4;
  
  // Whether this is an external inflow transaction
  bool is_external = 5;
}

// GetNetWorthRequest represents a request to get net worth
message GetNetWorthRequest {
  // Empty - no parameters needed
}

// GetNetWorthResponse returns the calculated net worth
message GetNetWorthResponse {
  // Total net worth as a decimal string (liquidity + equity)
  string total_net_worth = 1;
  
  // Liquidity (sum of PHYSICAL bucket balances) as a decimal string
  string liquidity = 2;
  
  // Equity (sum of EQUITY bucket market values) as a decimal string
  string equity = 3;
}

